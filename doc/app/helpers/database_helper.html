<!DOCTYPE html><html lang="en"><head><title>app/helpers/database_helper</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../../"><meta name="groc-document-path" content="app/helpers/database_helper"><meta name="groc-project-path" content="app/helpers/database_helper.rb"><link rel="stylesheet" type="text/css" media="all" href="../../assets/style.css"><script type="text/javascript" src="../../assets/behavior.js"></script><body><div id="meta"><div class="file-path">app/helpers/database_helper.rb</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h1 id="this-is-our-helper-for-the-pulling-config-stuff-out-of-the-database">This is our helper for the pulling config stuff out of the database.</h1>

<p>This file is for useful methods related to getting database config values and for rendering in general.
Helper methods defined here can be accessed in any controller or view in the application</p></div></div><div class="code"><div class="wrapper"><span class="k">module</span> <span class="nn">Wafelijzer</span>

  <span class="k">class</span> <span class="nc">App</span>
  <span class="k">module</span> <span class="nn">DatabaseHelper</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This method is for getting a Text from the database and rendering it from Markdown.</p></div></div><div class="code"><div class="wrapper">    <span class="k">def</span> <span class="nf">database_partial</span> <span class="n">title</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>query the database</p></div></div><div class="code"><div class="wrapper">      <span class="n">text</span> <span class="o">=</span> <span class="no">Text</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if the Text exists and is populated, render it</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="n">text</span> <span class="o">&amp;&amp;</span> <span class="n">text</span><span class="o">.</span><span class="n">body</span>
        <span class="nb">require</span> <span class="s1">&#39;kramdown&#39;</span>
        <span class="k">return</span> <span class="ss">Kramdown</span><span class="p">:</span><span class="ss">:Document</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">text</span><span class="o">.</span><span class="n">body</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>otherwise return false</p></div></div><div class="code"><div class="wrapper">      <span class="k">else</span>
        <span class="k">return</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This method is for getting a setting value from the database.</p></div></div><div class="code"><div class="wrapper">    <span class="k">def</span> <span class="nf">setting_value</span> <span class="n">title</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Query the database</p></div></div><div class="code"><div class="wrapper">      <span class="n">setting</span> <span class="o">=</span> <span class="no">Setting</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If the setting exists and is populated, render it</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="n">setting</span> <span class="o">&amp;&amp;</span> <span class="n">setting</span><span class="o">.</span><span class="n">body</span>
        <span class="k">return</span> <span class="n">setting</span><span class="o">.</span><span class="n">body</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Otherwise return false</p></div></div><div class="code"><div class="wrapper">      <span class="k">else</span>
        <span class="k">return</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is a wrapper function for checking which theme is set and getting its CSS <code>&lt;style&gt;</code> tag.</p></div></div><div class="code"><div class="wrapper">    <span class="k">def</span> <span class="nf">theme_css</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>first check which theme is being used</p></div></div><div class="code"><div class="wrapper">      <span class="n">themeObject</span> <span class="o">=</span> <span class="no">Setting</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">&quot;theme&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if a theme is set, call <code>theme_css_tag</code> on the theme name.</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="n">themeObject</span> <span class="o">&amp;&amp;</span> <span class="n">themeObject</span><span class="o">.</span><span class="n">body</span>
        <span class="k">if</span> <span class="n">theme_tag</span> <span class="o">=</span> <span class="n">theme_css_tag</span><span class="p">(</span><span class="n">themeObject</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">theme_tag</span>
        <span class="k">else</span>
          <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>otherwise return an empty string</p></div></div><div class="code"><div class="wrapper">      <span class="k">else</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is a function for getting the <code>&lt;style&gt;</code> tag associated with a given theme.</p></div></div><div class="code"><div class="wrapper">    <span class="k">def</span> <span class="nf">theme_css_tag</span> <span class="n">title</span>
      <span class="n">theme</span> <span class="o">=</span> <span class="no">Theme</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
      <span class="k">if</span> <span class="n">theme</span> <span class="o">&amp;&amp;</span> <span class="n">theme</span><span class="o">.</span><span class="n">css</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;&lt;style&gt;&quot;</span> <span class="o">+</span> <span class="n">theme</span><span class="o">.</span><span class="n">css</span> <span class="o">+</span> <span class="s2">&quot;&lt;/style&gt;&quot;</span>
        <span class="k">return</span> <span class="n">tag</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is a function for getting the <code>&lt;style&gt;</code> tag associated with a given theme.</p></div></div><div class="code"><div class="wrapper">    <span class="k">def</span> <span class="nf">theme_raw_css</span> <span class="n">title</span>
      <span class="n">theme</span> <span class="o">=</span> <span class="no">Theme</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
      <span class="k">if</span> <span class="n">theme</span> <span class="o">&amp;&amp;</span> <span class="n">theme</span><span class="o">.</span><span class="n">css</span>
        <span class="n">css</span> <span class="o">=</span> <span class="n">theme</span><span class="o">.</span><span class="n">css</span>
        <span class="k">return</span> <span class="n">css</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is a wrapper function for checking which theme is set and getting its JS <code>&lt;script&gt;</code> tag.</p></div></div><div class="code"><div class="wrapper">    <span class="k">def</span> <span class="nf">theme_js</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>First check which theme is being used</p></div></div><div class="code"><div class="wrapper">      <span class="n">themeObject</span> <span class="o">=</span> <span class="no">Setting</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">&quot;theme&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if a theme is set, call <code>theme_js_tag</code> on its name.</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="n">themeObject</span> <span class="o">&amp;&amp;</span> <span class="n">themeObject</span><span class="o">.</span><span class="n">body</span>
        <span class="k">if</span> <span class="n">theme_tag</span> <span class="o">=</span> <span class="n">theme_js_tag</span><span class="p">(</span><span class="n">themeObject</span><span class="o">.</span><span class="n">body</span><span class="p">)</span>
          <span class="k">return</span> <span class="n">theme_tag</span>
        <span class="k">else</span>
          <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if no theme is set, return an empty theme.</p></div></div><div class="code"><div class="wrapper">      <span class="k">else</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
      <span class="k">end</span>
    <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is a function for getting the <code>&lt;script&gt;</code> tag associated with a given theme.</p></div></div><div class="code"><div class="wrapper">    <span class="k">def</span> <span class="nf">theme_js_tag</span> <span class="n">title</span>
      <span class="n">theme</span> <span class="o">=</span> <span class="no">Theme</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="n">title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
      <span class="k">if</span> <span class="n">theme</span> <span class="o">&amp;&amp;</span> <span class="n">theme</span><span class="o">.</span><span class="n">js</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s2">&quot;&lt;script type=&#39;text/javascript&#39;&gt;&quot;</span> <span class="o">+</span> <span class="n">theme</span><span class="o">.</span><span class="n">js</span> <span class="o">+</span> <span class="s2">&quot;&lt;/script&gt;&quot;</span>
        <span class="k">return</span> <span class="n">tag</span>
      <span class="k">else</span>
        <span class="k">return</span> <span class="kp">false</span>
      <span class="k">end</span>
    <span class="k">end</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>This is a method for returning the typekit kit embed tag, if a typekit id is specified in the settings.</p></div></div><div class="code"><div class="wrapper">    <span class="k">def</span> <span class="nf">typekit_tag</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>first check the settings for a typekit ID</p></div></div><div class="code"><div class="wrapper">      <span class="n">typekit</span> <span class="o">=</span> <span class="no">Setting</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">&quot;typekit&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>if there is one, render the tag.</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span> <span class="n">typekit</span> <span class="o">&amp;&amp;</span> <span class="n">typekit</span><span class="o">.</span><span class="n">body</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;&lt;script type=&quot;text/javascript&quot; src=&quot;//use.typekit.net/&#39;</span> <span class="o">+</span> <span class="n">typekit</span><span class="o">.</span><span class="n">body</span> <span class="o">+</span> <span class="s1">&#39;.js&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot;&gt;try{Typekit.load();}catch(e){}&lt;/script&gt;&#39;</span>
        <span class="k">return</span> <span class="n">tag</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>otherwise return an empty string.</p></div></div><div class="code"><div class="wrapper">      <span class="k">else</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">helpers</span> <span class="no">DatabaseHelper</span>
  <span class="k">end</span>
<span class="k">end</span></div></div></div></div></body></html>